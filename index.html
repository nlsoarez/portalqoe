<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Banco de Horas - Controle Mensal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h2 {
      color: #2c3e50;
      border-bottom: 2px solid #f2c9a0;
      padding-bottom: 10px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f2c9a0;
      position: sticky;
      top: 0;
    }
    .violacao {
      background-color: #ff6666;
      color: white;
      font-weight: bold;
    }
    .excesso {
      background-color: #ffcccc;
    }
    .saldo-negativo {
      background-color: #ff9999;
    }
    .legenda {
      margin: 20px 0;
      padding: 15px;
      background-color: #f5f5f5;
      border-radius: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .legenda-item {
      display: flex;
      align-items: center;
    }
    .legenda-cor {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 8px;
      border: 1px solid #ddd;
    }
    .total {
      font-weight: bold;
      background-color: #e6e6e6;
    }
    .controles {
      margin: 20px 0;
      padding: 15px;
      background-color: #f0f8ff;
      border-radius: 5px;
    }
    .form-group {
      margin-bottom: 10px;
    }
    label {
      display: inline-block;
      width: 150px;
      font-weight: bold;
    }
    input, select {
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    button {
      padding: 8px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #45a049;
    }
    .filtros {
      margin-bottom: 15px;
    }
    .destaque {
      font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Banco de Horas - Controle Mensal</h2>

  <div class="legenda">
    <div class="legenda-item">
      <span class="legenda-cor" style="background-color: #ff6666;"></span>
      Violação: 3+ meses consecutivos >10h
    </div>
    <div class="legenda-item">
      <span class="legenda-cor" style="background-color: #ffcccc;"></span>
      Mês com >10h
    </div>
    <div class="legenda-item">
      <span class="legenda-cor" style="background-color: #ff9999;"></span>
      Saldo negativo
    </div>
  </div>

  <div class="controles">
    <h3>Adicionar Novo Mês</h3>
    <div class="form-group">
      <label for="novoMes">Mês:</label>
      <select id="novoMes">
        <option value="1">Junho</option>
        <option value="2">Julho</option>
        <option value="3">Agosto</option>
        <option value="4">Setembro</option>
        <option value="5">Outubro</option>
        <option value="6">Novembro</option>
        <option value="7">Dezembro</option>
      </select>
    </div>
    <button onclick="adicionarMes()">Adicionar Mês</button>
    <button onclick="exportarDados()">Exportar Dados</button>
    <button onclick="importarDados()">Importar Dados</button>
  </div>

  <div class="filtros">
    <label for="filtroNome">Filtrar por nome:</label>
    <input type="text" id="filtroNome" onkeyup="filtrarTabela()" placeholder="Digite o nome...">
    <label for="filtroViolacao" style="margin-left: 20px;">
      <input type="checkbox" id="filtroViolacao" onchange="filtrarTabela()"> Mostrar apenas violações
    </label>
  </div>

  <table id="tabelaHoras">
    <thead>
      <tr>
        <th>Analista</th>
        <th>Maio</th>
        <!-- Novos meses serão adicionados aqui -->
        <th>Total</th>
        <th>Meses >10h</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dados serão inseridos via JavaScript -->
    </tbody>
  </table>
</div>

<script>
  // Dados iniciais - Maio
  const dadosIniciais = [
    { nome: "LEANDRO GONÇALVES DE CARVALHO", maio: -4.22 },
    { nome: "BRUNO COSTA BUCARD", maio: 4.59 },
    { nome: "IGOR MARCELINO DE MARINS", maio: -0.16 },
    { nome: "GABRIELA TAVARES DA SILVA", maio: -10.34 },
    { nome: "MAGNO FERRAREZ DE MORAIS", maio: null },
    { nome: "DANIEL MARCELO FELISBERTO OLIVEIRA", maio: 8.02 },
    { nome: "FERNANDA MESQUITA DE FREITAS", maio: 2.42 },
    { nome: "ROBERTO SILVA DO NASCIMENTO", maio: 2.04 },
    { nome: "RODRIGO PIRES BERNARDINO", maio: 0.04 },
    { nome: "SUELLEN HERNANDEZ DA SILVA", maio: 10.08 },
    { nome: "MONICA DA SILVA RODRIGUES", maio: 10.57 },
    { nome: "MARLEY MARQUES RIBEIRO", maio: 11.51 },
    { nome: "KELLY PINHEIRO LIRA", maio: 1.56 },
    { nome: "JENNIFER MARIA ANDRADE SANTOS", maio: null },
    { nome: "THIAGO PEREIRA DA SILVA", maio: 9.39 },
    { nome: "LEONARDO FERREIRA LIMA DE ALMEIDA", maio: 9.27 },
    { nome: "MARISTELLA MARCIA DOS SANTOS", maio: 1.55 },
    { nome: "SANDRO DA SILVA CARVALHO", maio: -6.49 },
    { nome: "CRISTIANE HERMOGENES DA SILVA", maio: 9.55 },
    { nome: "JEFFERSON LUIS GONÇALVES COITINHO", maio: 14.36 },
    { nome: "EVILÁZIO ANDRÉ DE MAGALHÃES GOMES PEREIRA", maio: -59 },
    { nome: "ELBERTON ANICETO HENRIQUE", maio: 8.35 },
    { nome: "ALAN MARINHO DIAS", maio: 11.45 },
    { nome: "JULIO CESAR SANTOS SOARES", maio: 13.12 },
    { nome: "CARLOS EDUARDO BARRETO DE ABREU", maio: 7.07 },
    { nome: "ROSANA RIEGER MATOS", maio: 10.50 },
    { nome: "THIAGO DE SOUZA INACIO", maio: 8.40 }
  ];

  const meses = [
    { nome: "Maio", id: "maio" },
    // Outros meses serão adicionados dinamicamente
  ];

  document.addEventListener('DOMContentLoaded', function() {
    inicializarTabela();
  });

  function inicializarTabela() {
    const tbody = document.querySelector("#tabelaHoras tbody");
    tbody.innerHTML = "";

    dadosIniciais.forEach(funcionario => {
      const row = document.createElement("tr");
      
      // Nome do funcionário
      const nomeCell = document.createElement("td");
      nomeCell.textContent = funcionario.nome;
      row.appendChild(nomeCell);

      // Células para cada mês
      meses.forEach(mes => {
        const cell = document.createElement("td");
        const valor = funcionario[mes.id];
        cell.textContent = valor !== null ? valor.toFixed(2) : "";
        
        // Destacar valores > 10
        if (valor > 10) {
          cell.classList.add("excesso");
        }
        
        // Destacar valores negativos
        if (valor < 0) {
          cell.classList.add("saldo-negativo");
        }
        
        row.appendChild(cell);
      });

      // Célula de total
      const totalCell = document.createElement("td");
      totalCell.classList.add("total");
      row.appendChild(totalCell);

      // Célula de meses com excesso
      const excessoCell = document.createElement("td");
      row.appendChild(excessoCell);

      // Célula de status
      const statusCell = document.createElement("td");
      row.appendChild(statusCell);

      tbody.appendChild(row);
    });

    atualizarTotais();
    verificarViolacoes();
  }

  function adicionarMes() {
    const select = document.getElementById("novoMes");
    const mesIndex = parseInt(select.value);
    const mesesNomes = ["Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
    
    if (meses.length >= 8) {
      alert("Todos os meses já foram adicionados!");
      return;
    }

    const novoMes = {
      nome: mesesNomes[mesIndex],
      id: mesesNomes[mesIndex].toLowerCase()
    };

    meses.push(novoMes);

    // Adicionar coluna no cabeçalho
    const thead = document.querySelector("#tabelaHoras thead tr");
    const th = document.createElement("th");
    th.textContent = novoMes.nome;
    thead.insertBefore(th, thead.querySelector(".total"));

    // Adicionar células para cada funcionário
    const tbody = document.querySelector("#tabelaHoras tbody");
    const rows = tbody.querySelectorAll("tr");

    rows.forEach((row, index) => {
      const cell = document.createElement("td");
      cell.textContent = ""; // Valor vazio inicialmente
      cell.contentEditable = "true";
      cell.addEventListener("blur", function() {
        const valor = parseFloat(this.textContent) || null;
        dadosIniciais[index][novoMes.id] = valor;
        atualizarTotais();
        verificarViolacoes();
      });
      row.insertBefore(cell, row.querySelector(".total"));
    });

    // Atualizar o select para o próximo mês
    if (mesIndex < 6) {
      select.value = mesIndex + 1;
    } else {
      select.disabled = true;
    }

    alert(`Mês ${novoMes.nome} adicionado com sucesso! Preencha os valores para cada funcionário.`);
  }

  function atualizarTotais() {
    const rows = document.querySelectorAll("#tabelaHoras tbody tr");

    rows.forEach((row, index) => {
      let total = 0;
      let mesesExcesso = 0;

      // Calcular total e meses com excesso
      for (let i = 1; i < row.cells.length - 3; i++) {
        const valor = parseFloat(row.cells[i].textContent) || 0;
        total += valor;
        
        if (valor > 10) {
          mesesExcesso++;
        }
      }

      // Atualizar células de total e excesso
      row.cells[row.cells.length - 3].textContent = total.toFixed(2);
      row.cells[row.cells.length - 2].textContent = mesesExcesso;
    });
  }

  function verificarViolacoes() {
    const rows = document.querySelectorAll("#tabelaHoras tbody tr");

    rows.forEach(row => {
      let contagem = 0;
      let violou = false;

      // Verificar células de meses (ignorando nome, total, meses >10h e status)
      for (let i = 1; i < row.cells.length - 3; i++) {
        const celula = row.cells[i];
        const valor = parseFloat(celula.textContent) || 0;

        // Resetar classes de cor
        celula.classList.remove("excesso", "saldo-negativo");

        // Aplicar classes conforme necessário
        if (valor > 10) {
          celula.classList.add("excesso");
          contagem++;
          
          if (contagem >= 3) {
            violou = true;
          }
        } else {
          contagem = 0;
        }

        if (valor < 0) {
          celula.classList.add("saldo-negativo");
        }
      }

      // Atualizar status
      const statusCell = row.cells[row.cells.length - 1];
      statusCell.textContent = violou ? "Violação" : "OK";
      statusCell.className = violou ? "destaque violacao" : "";

      // Destacar linha se violou
      if (violou) {
        row.classList.add("violacao");
      } else {
        row.classList.remove("violacao");
      }
    });
  }

  function filtrarTabela() {
    const filtroNome = document.getElementById("filtroNome").value.toUpperCase();
    const filtroViolacao = document.getElementById("filtroViolacao").checked;
    const rows = document.querySelectorAll("#tabelaHoras tbody tr");

    rows.forEach(row => {
      const nome = row.cells[0].textContent.toUpperCase();
      const violacao = row.classList.contains("violacao");
      
      const mostraNome = nome.includes(filtroNome);
      const mostraViolacao = !filtroViolacao || violacao;
      
      row.style.display = (mostraNome && mostraViolacao) ? "" : "none";
    });
  }

  function exportarDados() {
    const dadosParaExportar = {
      meses: meses,
      funcionarios: dadosIniciais
    };
    
    const blob = new Blob([JSON.stringify(dadosParaExportar, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'banco_de_horas.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function importarDados() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      
      reader.onload = event => {
        try {
          const dados = JSON.parse(event.target.result);
          
          // Atualizar meses
          meses.length = 1; // Mantém apenas Maio
          for (let i = 1; i < dados.meses.length; i++) {
            meses.push(dados.meses[i]);
          }
          
          // Atualizar dados dos funcionários
          dados.funcionarios.forEach((func, index) => {
            Object.assign(dadosIniciais[index], func);
          });
          
          // Reconstruir tabela
          inicializarTabela();
          alert('Dados importados com sucesso!');
        } catch (error) {
          alert('Erro ao importar dados: ' + error.message);
        }
      };
      
      reader.readAsText(file);
    };
    
    input.click();
  }
</script>
</body>
</html>
