<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard de Análise de Volumetria</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --accent-color: #e74c3c;
      --light-color: #ecf0f1;
      --dark-color: #34495e;
      --success-color: #27ae60;
      --text-color: #333;
      --text-light: #7f8c8d;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      color: var(--text-color);
      background-color: #f5f7fa;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 500;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .data-info {
      font-size: 14px;
      color: var(--text-light);
      margin-top: 10px;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .file-input-container {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .file-input-wrapper {
      position: relative;
      flex-grow: 1;
    }
    
    .file-input-label {
      display: block;
      padding: 10px 15px;
      background-color: var(--secondary-color);
      color: white;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    
    #fileInput {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .btn {
      padding: 10px 20px;
      background-color: var(--success-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255,255,255,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    .loading.active {
      display: flex;
    }
    
    .spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--secondary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Restante do CSS permanece igual */
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-chart-bar"></i>
        <h1>Dashboard de Análise de Volumetria</h1>
      </div>
    </div>
    <div class="container">
      <div class="data-info" id="dataInfo">Nenhum arquivo carregado</div>
    </div>
  </header>
  
  <div class="container">
    <div class="card">
      <div class="card-title">Carregar Dados</div>
      <div class="file-input-container">
        <div class="file-input-wrapper">
          <label for="fileInput" class="file-input-label">
            <i class="fas fa-file-excel"></i> Selecionar Arquivos Excel
          </label>
          <input type="file" id="fileInput" multiple accept=".xlsx, .xls">
        </div>
        <button class="btn" id="processBtn">
          <i class="fas fa-cogs"></i> Processar Dados
        </button>
      </div>
    </div>
    
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Processando dados...</p>
    </div>
    
    <div id="analysisSection" style="display: none;">
      <!-- Conteúdo da análise será inserido aqui -->
    </div>
  </div>

  <script>
    // Continua na Parte 2...
        // Verificar se elementos existem
    const elements = {
      dataInfo: document.getElementById('dataInfo'),
      processBtn: document.getElementById('processBtn'),
      fileInput: document.getElementById('fileInput'),
      loading: document.getElementById('loading'),
      analysisSection: document.getElementById('analysisSection')
    };
    
    if (!elements.dataInfo || !elements.processBtn || !elements.fileInput || 
        !elements.loading || !elements.analysisSection) {
      console.error('Elementos essenciais não encontrados no DOM');
      if (elements.dataInfo) {
        elements.dataInfo.textContent = 'Erro: Elementos não carregados corretamente';
      }
    }

    let originalData = [];
    let charts = {};
    const diasSemana = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];

    function showLoading(show) {
      if (elements.loading) {
        elements.loading.style.display = show ? 'flex' : 'none';
      }
    }

    async function loadFiles() {
      try {
        if (!elements.fileInput.files.length) {
          updateDataInfo('Por favor, selecione pelo menos um arquivo Excel', 'error');
          return;
        }

        showLoading(true);
        
        const promises = Array.from(elements.fileInput.files).map(file => {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = e => {
              try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet, { defval: "" });
                
                const processedData = json.map(row => {
                  // Processar datas - verifica múltiplos formatos
                  const dateKeys = Object.keys(row).filter(k => 
                    k.toLowerCase().includes('data') || 
                    k.toLowerCase().includes('hora'));
                  
                  if (dateKeys.length > 0) {
                    for (const key of dateKeys) {
                      const dateStr = row[key];
                      if (!dateStr) continue;
                      
                      // Tentar parsear como Date
                      if (dateStr instanceof Date) {
                        row._date = dateStr;
                        break;
                      }
                      
                      // Tentar formato dd/mm/aaaa hh:mm
                      const brMatch = dateStr.toString().match(/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2})/);
                      if (brMatch) {
                        row._date = new Date(
                          parseInt(brMatch[3]),
                          parseInt(brMatch[2]) - 1,
                          parseInt(brMatch[1]),
                          parseInt(brMatch[4]),
                          parseInt(brMatch[5])
                        );
                        break;
                      }
                      
                      // Tentar formato ISO
                      const date = new Date(dateStr);
                      if (!isNaN(date.getTime())) {
                        row._date = date;
                        break;
                      }
                    }
                  }
                  return row;
                }).filter(row => row._date);
                
                resolve(processedData);
              } catch (error) {
                reject(`Erro ao processar ${file.name}: ${error.message}`);
              }
            };
            
            reader.onerror = () => reject(`Erro ao ler ${file.name}`);
            reader.readAsArrayBuffer(file);
          });
        });

        const results = await Promise.all(promises);
        originalData = results.flat();
        
        if (originalData.length === 0) {
          updateDataInfo('Nenhum dado válido encontrado. Verifique o formato das datas (dd/mm/aaaa hh:mm)', 'error');
          return;
        }
        
        updateDataInfo(`${originalData.length} registros carregados`, 'success');
        elements.analysisSection.style.display = 'block';
        analyzeData(originalData);
      } catch (error) {
        console.error('Erro:', error);
        updateDataInfo(error.toString(), 'error');
      } finally {
        showLoading(false);
      }
    }

    function updateDataInfo(message, type = 'info') {
      if (!elements.dataInfo) return;
      
      elements.dataInfo.textContent = message;
      elements.dataInfo.style.color = 
        type === 'error' ? 'var(--accent-color)' : 
        type === 'success' ? 'var(--success-color)' : 
        'var(--text-light)';
    }

    function analyzeData(data) {
      // Implementar análise dos dados
      console.log('Dados para análise:', data);
      
      // Exemplo simples de análise
      const total = data.length;
      const firstDate = data[0]._date;
      const lastDate = data[data.length - 1]._date;
      
      updateDataInfo(
        `${total} registros | Período: ${formatDate(firstDate)} a ${formatDate(lastDate)}`,
        'success'
      );
    }

    function formatDate(date) {
      if (!date || isNaN(date.getTime())) return 'data inválida';
      return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
    }

    // Event listeners
    if (elements.processBtn) {
      elements.processBtn.addEventListener('click', loadFiles);
    }

    // Inicialização
    console.log('Dashboard inicializado');
  </script>
</body>
</html>
